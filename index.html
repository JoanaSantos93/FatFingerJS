<html>
<head>
    <script type="text/javascript" src="lib/jquery-3.2.0.js"></script>
    <script type="text/javascript" src="lib/jslint.js"></script>
    <script type="text/javascript" src="lib/parse-js.js"></script>
    <script type="text/javascript" src="src/bigHeader.js"></script>
    <script type="text/javascript" src="src/parsingTools.js"></script>
    <script type="text/javascript" src="src/wordMatcher.js"></script>
    <script type="text/javascript" src="src/wordReplacer.js"></script>
    <script type="text/javascript" src="src/javascirpt-main.js"></script>
    <script type="text/javascript">

        $(document).ready(function() {
            $('#btnSubmit').click(function() {
                $('#errors').text('');
                $('#output').text('');
                $('#newprogram').text('');

                var code = $('#jstext').val();

                var result = javaScirpt.run(code);
                if (result.succeeded) {
                    $('#newprogram').text(result.text);
                    ast = parse(result.text);
                    printNode(ast, 0);
                }
                else {
                    $('#errors').text(result.text);
                }
            });
        });

        $(document).delegate('#jstext', 'keydown', function(e) {
            var keyCode = e.keyCode || e.which;

            if (keyCode == 9) {
                e.preventDefault();
                var start = $(this).get(0).selectionStart;
                var end = $(this).get(0).selectionEnd;

                // set textarea value to: text before caret + tab + text after caret
                $(this).val($(this).val().substring(0, start)
                            + "\t"
                            + $(this).val().substring(end));

                // put caret at right position again
                $(this).get(0).selectionStart =
                $(this).get(0).selectionEnd = start + 1;
            }
        });

        $(document).ready(function () {
            $('#cbTree').change(function () {
                if ($('#cbTree').is(':checked')) {
                    $('#treeHolder').show();
                } else {
                    $('#treeHolder').hide();
                }
            });
        });

        // print the whole tree, node by node
        function printNode(node, indents) {
            if (node == null) return; // empty commands sometimes produce null nodes
            if (node.constructor === Array) {
                for(var j = 0; j < node.length; j++) {
                    printNode(node[j], indents + 1);
                }
            } 
            else {
                for(var i = 0; i < indents; i++) {
                    $('#output').append('  ');
                }
                $('#output').append(node);
                $('#output').append("<br/>");
            }
        }
    </script>
    <style type="text/css">
    .boxy {
        -moz-appearance: textfield-multiline;
        -webkit-appearance: textarea;
        border: 1px solid gray;
        font: medium -moz-fixed;
        font: -webkit-small-control;
        overflow: auto;
        padding: 0px;
        resize: both;
        width: 400px;
        height: 400px;
        margin: 0px;
    }
    .holder {
        margin: 10px;
        float: left;
    }
    h2 {
        margin-left: 10px;
    }
    #treeHolder {
        display: none;
    }
    </style>
    <title>JavaScirpt</title>
</head>
<body>
    <h2>Test your JavaScirpt code</h2>
    <div class="holder">
        <b>INPUT (JavaScirpt)</b><br><br>
        <textarea id="jstext" class="boxy">
vart x = "Hullllo Werldd!"

dokkcccccccccccccumint.rit3(xx)            
        </textarea>
        <br />
        <input type="button" value="Submit" id="btnSubmit" />
        <input type="checkbox" value="tree" id="cbTree" /><label for="cbTree">Draw Syntax Tree</label>
        <br />
        <div id="errors" style="color: #aa0000;"></div>
        <br/>
    </div>
    <div class="holder">
        <b>OUTPUT (conventional JavaScript)</b><br><br>
        <div id="outbox" class="boxy">
            <pre><code id="newprogram"></code></pre>
        </div>
    </div>
    <div class="holder" id="treeHolder">
        <b>SYNTAX TREE</b><br/><br/>
        <div class="boxy">
            <pre><code id="output" style="width: 100%;"></code></pre>
        </div>
    </div>
</body>
</html>